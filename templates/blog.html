{% import "macros/prose.html" as macros %}
{% extends "_base.html" %}

{% block page %}blog{% endblock page%}
{% block lang %}{% if section.extra.lang %}{{ section.extra.lang }}{% else %}{{ section.lang }}{% endif %}{% endblock lang %}
{% block title %}{{ section.title }}{% endblock title %}
{% block desc %}
  {% if section.description %}
    {% set desc = section.description %}
  {% else %}
    {% set desc = config.description %}
  {% endif %}
  <meta name="description" content="{{ desc }}">
{% endblock desc %}

{% block content %}
<div id="wrapper">
  {{ macros::back_link(path = get_url(path="/")) }}
  {% include "_section_title.html" %}
  <main class="layout-list">
    
    {# Show root posts first (without headings) #}
    {% if section.pages | length > 0 %}
    <div class="post-list">
      {% for post in section.pages | sort(attribute="date") | reverse %}
      <a class="post instant {% if post.extra.featured %}featured{% endif %}" href="{{ post.permalink }}">
        <span>{{ post.title }}</span>
        <span class="date">{{ post.date | date(format=section.extra.date_format) }}</span>
      </a>
      {% endfor %}
    </div>
    {% endif %}
    
    {# Show subsections with headings #}
    {% for subsection_path in section.subsections | sort %}
      {% set subsection = get_section(path=subsection_path) %}
      
      {% if subsection.pages | length > 0 %}
      <h2 class="category">{{ subsection.title }}</h2>
      <div class="post-list categorized">
        {% for post in subsection.pages | sort(attribute="date") | reverse %}
        <a class="post instant {% if post.extra.featured %}featured{% endif %}" href="{{ post.permalink }}">
          <span>{{ post.title }}</span>
          <span class="date">{{ post.date | date(format=section.extra.date_format) }}</span>
        </a>
        {% endfor %}
      </div>
      {% endif %}
    {% endfor %}
    
  </main>
  {% include "_footer.html" %}
</div>
{% endblock content %}